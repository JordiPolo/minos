dist: xenial
language: rust
services: docker
sudo: required
env:
  global:
  - CRATE_NAME=minos
  - RUST_BACKTRACE=full
matrix:
  include:
    - env: TARGET=x86_64-unknown-linux-musl
      rust: nightly
    - env: TARGET=x86_64-apple-darwin
      os: osx
      rust: nightly
before_install:
- set -e
- rustup self update
install:
- sh ci/install.sh
- source ~/.cargo/env || true
script:
- bash ci/script.sh
after_script: set +e
before_deploy:
- sh ci/before_deploy.sh
deploy:
  api_key:
    secure: YDB8NEFbUnJPqn0w7S3YWm2NnPF3tjhDKjKmfjTJy1Lq2g+rrhfyyJrRKceUZAop9musI59/14Gz8TIKJrv1ZiWe94Md16U2Jn8oDTAFe0euO3uyi/3Bww5I/iuHtjnwHNWGpPkJkecWS0+rO16lJeEcdca9n6M6SS3wuurrymRThjZLUqsO79ZlpjuPYNp9nr2/C5UgL5jsV4yr2/2GNmGpKr2pmYR12inNgKoqHDaoi9IEeIfSZdyDghd9rHmBDWZ///Cupa1tWJ4T2Xq0Z3BU5IIiOXK4O8NNCq57SO+SL92kLkN/Dm1cyyDdnCSRVIE3oQxGBzeFF+g2Qs3KVKV6MPjJi7nsCR7PeLkj8ayZ8RUA+rwWyKpiK/AFPzmdBlORDnAuAm/XzWvM0YHyymFKzIfq5PWmCwyPJU+HQtD5QiM5ZckE6gXDdEjQ0mtZyegnub+SaaqDGp0EwLSTagRIcQn9AfXWSKn05MgpXjUbmVllE2GcaQTomO3SV9f4HfixxiK7m8+Co5Boi84G7gJ4/u6yz4w78JktA9FfxvOvw8TgxC68nMmeIO2+1/Swj6mNANKSJiB+wSRrenMtyMxfEyoa2aSluB5k9ZgKKtgnPZ+uZM8t0hfHIXRJ45+wGpyET2y/o41HDgXDZQDxRGFKNf34w9BCF9umyUNC2FQ=
  file_glob: true
  file: "$CRATE_NAME-$TRAVIS_TAG-$TARGET.*"
  on:
    condition: "$TRAVIS_RUST_VERSION = nightly"
    tags: true
  provider: releases
  skip_cleanup: true
cache: cargo
before_cache:
- chmod -R a+r $HOME/.cargo
branches:
  only:
  - "/^v\\d+\\.\\d+\\.\\d+.*$/"
  - master
notifications:
  email:
    on_success: never
